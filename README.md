# üè¶ My Bank ‚Äî Sprint Project (Yandex Practicum)

# –î–æ–º–∞—à–Ω—è—è —Ä–∞–±–æ—Ç–∞ –∫ –¥–µ–≤—è—Ç–æ–º—É —Å–ø—Ä–∏–Ω—Ç—É –∫—É—Ä—Å–∞ Java Middle Developer (Yandex Practicum)

---

# –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π **–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ¬´–ë–∞–Ω–∫¬ª**, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞ –±–∞–∑–µ Spring Boot –∏ Spring Cloud.

–°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:

| –°–µ—Ä–≤–∏—Å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|------------|
| **Front UI** | –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| **Accounts Service** | –ê–∫–∫–∞—É–Ω—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –±–∞–ª–∞–Ω—Å |
| **Cash Service** | –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ —Å–Ω—è—Ç–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ |
| **Transfer Service** | –ü–µ—Ä–µ–≤–æ–¥—ã –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ |
| **Notifications Service** | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (Outbox / Event Store) |
| **Gateway** | API Gateway |
| **Config Server** | –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è |
| **Eureka** | Service Discovery |
| **Keycloak** | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —Ä–æ–ª–∏ |
| **PostgreSQL** | –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö |

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–º—É –ø–æ–¥—Ö–æ–¥—É –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç REST‚Äë–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏.

---

# üß≠ –õ–∏—á–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

–í –¥–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ —è —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ –≤—ã—à–µ–ª –∏–∑ –∑–æ–Ω—ã –∫–æ–º—Ñ–æ—Ä—Ç–∞:

- –ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ **Maven**, –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Gradle
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π Spring MVC**, –±–µ–∑ WebFlux

–ü–æ—Å–ª–µ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –Ω–∞ Gradle –∏ WebFlux —è –æ—â—É—Ç–∏–ª —Ä–∞–∑–Ω–∏—Ü—É –≤ –ª–∞–∫–æ–Ω–∏—á–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π, –≥–∏–±–∫–æ—Å—Ç–∏ —Å–±–æ—Ä–∫–∏ –∏ –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å—Ç–∏–ª—è. –¢–µ–º –Ω–µ –º–µ–Ω–µ–µ, —Ä–∞–±–æ—Ç–∞ –ø–æ–∑–≤–æ–ª–∏–ª–∞ –≥–ª—É–±–∂–µ –ø–æ–Ω—è—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ Spring Boot –≤ –±–æ–ª–µ–µ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ–º (servlet) —Å—Ç–µ–∫–µ.

---

# üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

- OAuth 2.0
- OpenID Connect
- Keycloak (Docker)

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ Keycloak. JWT access token –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–∏—Å–∞–º.

### –ú–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
–°–µ—Ä–≤–∏—Å—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —á–µ—Ä–µ–∑ **client_credentials** flow.  
–ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –≤—ã—Å—Ç—É–ø–∞–µ—Ç –∫–∞–∫ OAuth2 client –∏ Resource Server –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

---

# üê≥ Docker-—Å—Ç–µ–Ω–¥

–ü–æ–¥–Ω–∏–º–∞—é—Ç—Å—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (–≤ –ø–æ—Ä—è–¥–∫–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–¥–Ω—è—Ç–∏—è):

```
postgres
keycloak
eureka
config-server
gateway
notifications-service
accounts-service
cash-service
transfer-service
frontend
nginx
ngrok
```

---

# üì¶ –°–µ—Ä–≤–∏—Å—ã

## üßë Accounts Service

| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| GET | `/accounts/me` | –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| PUT | `/accounts/me` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è |
| GET | `/accounts/all` | –°–ø–∏—Å–æ–∫ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| POST | `/accounts/balance` | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π) |
| POST | `/accounts/transfer` | –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ (consume) |

---

## üí∞ Cash Service

| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| GET | `/cash/operation-key` | –ü–æ–ª—É—á–∏—Ç—å idempotency –∫–ª—é—á |
| POST | `/cash/operate` | –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ / —Å–Ω—è—Ç–∏–µ |

---

## üîÅ Transfer Service

| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| GET | `/transfer/operation-key` | –ü–æ–ª—É—á–∏—Ç—å idempotency –∫–ª—é—á |
| POST | `/transfer/transfer` | –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥ |

---

## üîî Notifications Service

| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| POST | `/notifications` | –°–æ–∑–¥–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ |

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –û—Ç–≤–µ—Ç: **202 Accepted**
- Idempotency —á–µ—Ä–µ–∑ `(service, operation_id)`
- –•—Ä–∞–Ω–µ–Ω–∏–µ JSON payload

---

# üë§ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –≤ Keycloak –∑–∞–≤–µ–¥–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:

| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å | –õ–æ–≥–∏–Ω     | –ü–∞—Ä–æ–ª—å |
|--------------|-----------|--------|
| –ö–ª–∏–µ–Ω—Ç 1 | **Alice** | alice |
| –ö–ª–∏–µ–Ω—Ç 2 | **Bob**  | bob |

–≠—Ç–∏ —É—á–µ—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤, –æ–ø–µ—Ä–∞—Ü–∏–π —Å –±–∞–ª–∞–Ω—Å–æ–º –∏ —Ä–∞–±–æ—Ç—ã –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

---

# ‚öô –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–æ–≤ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ô –®–ê–ì –î–õ–Ø –í–ê–†–ò–ê–ù–¢–ê 1)

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Docker BuildKit + multi-stage —Å–±–æ—Ä–∫—É**, –ø–æ—ç—Ç–æ–º—É:

‚úî Maven –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ **–ù–ï –Ω—É–∂–µ–Ω**  
‚úî –í—Å—ë —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ Docker

–í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:

```bash
docker buildx bake --load -f docker-bake.hcl
```

---

# üöÄ –í–ê–†–ò–ê–ù–¢ 1. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞ (—á–µ—Ä–µ–∑ Docker Compose)

```bash
docker compose --env-file docker-compose.env up -d
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ:

```
http://localhost:8081
```

---

# üöÄ –í–ê–†–ò–ê–ù–¢ 2. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞ –í–†–£–ß–ù–£–Æ (–±–µ–∑ –æ–±—â–µ–π docker-compose —Å–µ—Ç–∏)

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –æ—Ç–ª–∞–¥–∫–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

## 1Ô∏è‚É£ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö. –í –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ etc –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É

```bash
docker run --name yp-database --rm --env-file postgres.env -p 5432:5432 postgres:18.1
```

## 2Ô∏è‚É£ Keycloak. –í –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ KeycloakContainer –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É

```bash
docker compose up -d --build
```

---

## 3Ô∏è‚É£ –î–∞–ª–µ–µ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã –ª–æ–∫–∞–ª—å–Ω–æ –∏–∑ IDE –≤ –ø–æ—Ä—è–¥–∫–µ:

1. **Discovery-service**
2. **Config-service**
3. **Gateway-service**

–î–∞–ª—å–Ω–µ–π—à–∏–π –ø–æ—Ä—è–¥–æ–∫ –Ω–µ –≤–∞–∂–µ–Ω:

- Notifications-service
- Accounts-service
- Cash-service
- Transfer-service
- Front-ui

---

üìå **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**

- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã **nginx** –∏ **ngrok** –ø—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–∏—Å–æ–≤ **–Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è**
- –î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –æ—Å—Ç–∞—ë—Ç—Å—è:

```
http://localhost:8081
```

---

# üîê SSO (Keycloak)

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Single Sign-On —á–µ—Ä–µ–∑ Keycloak**.

### –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
–ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏:

```
http://localhost:8081
```

–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞ Keycloak.

### –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞

Keycloak –≤—ã–¥–∞—ë—Ç JWT —Ç–æ–∫–µ–Ω, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

- Gateway
- Accounts Service
- Cash Service
- Transfer Service
- Notifications Service

### –¢–∏–ø—ã —Ç–æ–∫–µ–Ω–æ–≤

| –ö—Ç–æ | –ö–∞–∫–æ–π —Ç–æ–∫–µ–Ω |
|-----|------------|
| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å | Authorization Code Flow |
| –°–µ—Ä–≤–∏—Å ‚Üî —Å–µ—Ä–≤–∏—Å | Client Credentials Flow |

---

# üß† –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º

| –≠—Ç–∞–ø | –ì–¥–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è |
|------|----------------|
| Maven —Å–±–æ—Ä–∫–∞ | –≤–Ω—É—Ç—Ä–∏ Docker builder stage |
| –ö—ç—à –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Maven | —á–µ—Ä–µ–∑ BuildKit cache mount |
| –§–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ | –ª—ë–≥–∫–∏–π JRE runtime |
| –õ–æ–∫–∞–ª—å–Ω—ã–π Maven | **–Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è** |

---

# üßπ –í–ê–ñ–ù–û: .gitignore

```
.buildx-cache/
.buildx-cache/blobs/
.buildx-cache/index.json
.buildx-cache/ingest/
```

---

# üèó –°—Ç–µ–∫

- Spring Boot Microservices
- Spring Cloud (Gateway, Config, Eureka)
- Keycloak (SSO)
- PostgreSQL
- Docker + BuildKit
- Nginx + ngrok

---

# üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (—Å—Ö–µ–º–∞)

–ù–∏–∂–µ ‚Äî —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ docker-—Å—Ç–µ–Ω–¥–µ:

```text
                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                   ‚îÇ                 Browser / User             ‚îÇ
                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                              ‚îÇ
                                              ‚ñº
                                     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                     ‚îÇ    Nginx (gw)   ‚îÇ
                                     ‚îÇ  reverse proxy  ‚îÇ
                                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                             ‚îÇ  /mybank/*
                                             ‚ñº
                                     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                     ‚îÇ     Front UI    ‚îÇ
                                     ‚îÇ  (web, 8081)    ‚îÇ
                                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                             ‚îÇ REST calls (JWT)
                                             ‚ñº
                                     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                     ‚îÇ Gateway Service ‚îÇ
                                     ‚îÇ  (edge API)     ‚îÇ
                                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                             ‚îÇ routes by service
                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                   ‚îÇ                         ‚îÇ                         ‚îÇ
                   ‚ñº                         ‚ñº                         ‚ñº
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ Accounts Service ‚îÇ       ‚îÇ   Cash Service  ‚îÇ       ‚îÇ Transfer Service‚îÇ
          ‚îÇ /accounts/*      ‚îÇ       ‚îÇ /cash/*         ‚îÇ       ‚îÇ /transfer/*     ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ                         ‚îÇ                          ‚îÇ
                  ‚îÇ (service-to-service)    ‚îÇ (service-to-service)     ‚îÇ (service-to-service)
                  ‚îÇ OAuth2 client_credentials (JWT, roles)             ‚îÇ
                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                  ‚ñº                   ‚ñº
                         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                         ‚îÇ Notifications   ‚îÇ  ‚îÇ PostgreSQL               ‚îÇ
                         ‚îÇ Service         ‚îÇ  ‚îÇ schemas: accounts/cash/  ‚îÇ
                         ‚îÇ /notifications  ‚îÇ  ‚îÇ transfer/notifications   ‚îÇ
                         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ Eureka (discovery)           ‚îÇ  ‚Üê service registration
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ Config Server                ‚îÇ  ‚Üê centralized config
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ Keycloak                     ‚îÇ  ‚Üê OAuth2/OIDC issuer (JWT)
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ Ngrok          )             ‚îÇ  ‚Üê public domain ‚Üí Nginx ((–¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ Docker)
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
- –≤–Ω–µ—à–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ **Nginx ‚Üí Front UI ‚Üí Gateway**
- —Å–µ—Ä–≤–∏—Å—ã —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –≤ **Eureka** –∏ –ø–æ–ª—É—á–∞—é—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ **Config Server**
- –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è **Keycloak** (JWT, roles)
- –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ **Notifications Service (Outbox)**
- –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö ‚Äî —á–µ—Ä–µ–∑ **—Å—Ö–µ–º—ã PostgreSQL** (–ø–æ —Å–µ—Ä–≤–∏—Å—É)

# üîÑ Flow –æ–ø–µ—Ä–∞—Ü–∏–π

–ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –¥–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-—Å—Ü–µ–Ω–∞—Ä–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ API –∏ –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤.

## 1) –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ / —Å–Ω—è—Ç–∏–µ (deposit / withdraw)

**–¶–µ–ª—å:** –∏–∑–º–µ–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –ø–æ–≤—Ç–æ—Ä–æ–≤ (idempotency).

### –®–∞–≥–∏

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ (idempotency key)**
    - –ö–ª–∏–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç:
        - `GET /cash/operation-key`
    - –í –æ—Ç–≤–µ—Ç –ø–æ–ª—É—á–∞–µ—Ç `operationId` (–∫–ª—é—á –æ–ø–µ—Ä–∞—Ü–∏–∏).

2. **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è/—Å–Ω—è—Ç–∏—è**
    - –ö–ª–∏–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç:
        - `POST /cash/operate`
    - –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç `operationId` –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Ç–∏–ø, —Å—É–º–º–∞ –∏ —Ç.–ø.).
    - Cash Service —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –≤ —Å–≤–æ–µ–π —Å—Ö–µ–º–µ –ë–î –∏ –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞.

3. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –≤ Accounts Service**
    - Cash Service –≤—ã–∑—ã–≤–∞–µ—Ç **Accounts Service** (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π endpoint):
        - `POST /accounts/balance`
    - –í—ã–∑–æ–≤ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å —Å–µ—Ä–≤–∏—Å–Ω—ã–º JWT (client_credentials).
    - Accounts Service –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ —Å —É—á—ë—Ç–æ–º –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ `service_operations`).

4. **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
    - –°–µ—Ä–≤–∏—Å –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä (Cash) –≤—ã–∑—ã–≤–∞–µ—Ç:
        - `POST /notifications`
    - –í Notifications Service —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å (Outbox) —Å –∫–ª—é—á–æ–º `(service, operation_id)` –∏ JSON payload.

### –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- –∫–ª—é—á –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞—Ä–∞–Ω–µ–µ (`/cash/operation-key`)
- –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤ —Å —Ç–µ–º –∂–µ `(service, operation_id)` –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –¥–≤–æ–π–Ω–æ–º—É —Å–ø–∏—Å–∞–Ω–∏—é/–∑–∞—á–∏—Å–ª–µ–Ω–∏—é
- Notifications —Ç–∞–∫–∂–µ –∑–∞—â–∏—â—ë–Ω –æ—Ç –¥—É–±–ª–µ–π —Å–æ—Å—Ç–∞–≤–Ω—ã–º –∫–ª—é—á–æ–º

---

## 2) –ü–µ—Ä–µ–≤–æ–¥ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (transfer)

**–¶–µ–ª—å:** —Å–ø–∏—Å–∞—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞ —É –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è –∏ –∑–∞—á–∏—Å–ª–∏—Ç—å –ø–æ–ª—É—á–∞—Ç–µ–ª—é, –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.

### –®–∞–≥–∏

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏**
    - –ö–ª–∏–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç:
        - `GET /transfer/operation-key`
    - –ü–æ–ª—É—á–∞–µ—Ç `operationId`.

2. **–°–æ–∑–¥–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–≤–æ–¥–∞**
    - –ö–ª–∏–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç:
        - `POST /transfer/transfer`
    - Transfer Service —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –ø–µ—Ä–µ–≤–æ–¥–∞ –≤ —Å–≤–æ–µ–π —Å—Ö–µ–º–µ –ë–î –∏ –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–æ–≤.

3. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤ (–º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ)**
    - Transfer Service –≤—ã–∑—ã–≤–∞–µ—Ç Accounts Service (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π endpoint):
        - `POST /accounts/transfer`
    - –í—ã–∑–æ–≤ –∏–¥—ë—Ç —Å —Å–µ—Ä–≤–∏—Å–Ω—ã–º JWT (client_credentials).
    - Accounts Service –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ø–∏—Å–∞–Ω–∏–µ/–∑–∞—á–∏—Å–ª–µ–Ω–∏–µ –∏ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Ñ–∞–∫—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è (idempotency).

4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ**
    - –°–µ—Ä–≤–∏—Å –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä (Transfer) –≤—ã–∑—ã–≤–∞–µ—Ç:
        - `POST /notifications`
    - –í Outbox —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è JSON payload –∏ –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å –¥–æ—Å—Ç–∞–≤–∫–∏.

### –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å —Ç–µ–º –∂–µ `operationId` –¥–æ–ª–∂–µ–Ω —Å—á–∏—Ç–∞—Ç—å—Å—è –¥—É–±–ª–µ–º
- –∫–ª—é—á —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏: `(service, operation_id)`
- —ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å Retry –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Å–µ—Ç–∏/–≤—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

---

## –í–∞–∂–Ω–æ –ø—Ä–æ SAGA (–ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞ —Ä–∞–∑–≤–∏—Ç–∏—è)

–ü–µ—Ä–µ–≤–æ–¥ –¥–µ–Ω–µ–≥ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –æ–±—Ä–∞–∑–æ–º —É–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –≤ –ø–∞—Ç—Ç–µ—Ä–Ω **SAGA**.  
–í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –ø–µ—Ä–µ–≤–æ–¥ –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –µ–¥–∏–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ –≤—ã–∑–æ–≤–æ–≤, –æ–¥–Ω–∞–∫–æ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –∏—Ç–µ—Ä–∞—Ü–∏—è—Ö –ª–æ–≥–∏—á–Ω–æ:
- —Ä–∞–∑–¥–µ–ª–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞ 2 –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö —à–∞–≥–∞ (debit/credit)
- –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏
- —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ö–æ—Ä–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫—É—é SAGA –¥–ª—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

---


# üß† –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏ –æ–ø—ã—Ç

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è

#### Idempotency
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–æ—Å—Ç–∞–≤–Ω–æ–π –∫–ª—é—á `(service, operation_id)` –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.

#### Notifications –∫–∞–∫ Outbox
–°–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Ö—Ä–∞–Ω–∏—Ç —Å–æ–±—ã—Ç–∏—è, —Å—Ç–∞—Ç—É—Å –¥–æ—Å—Ç–∞–≤–∫–∏, –ø–æ–ø—ã—Ç–∫–∏ –∏ –æ—à–∏–±–∫–∏.

#### OAuth2 –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Ä–≤–∏—Å–æ–≤
–ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å ‚Äî Resource Server + OAuth2 Client.

#### Circuit Breaker –∏ Retry
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Resilience4j –¥–ª—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤.

#### Multi-schema Postgres
–ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é —Å—Ö–µ–º—É:

```
accounts
cash
transfer
notifications
```

#### Docker –∏ multi-module —Å–±–æ—Ä–∫–∞
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–±–æ—Ä–∫–∏ multi-module Maven –ø—Ä–æ–µ–∫—Ç–∞ –≤–Ω—É—Ç—Ä–∏ Docker —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

---

# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–í –ø—Ä–æ–µ–∫—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –º–æ–¥—É–ª—å–Ω–æ–µ, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ—Ç—Ä–∞–∂–∞—é—â–µ–µ —Ä–µ–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–∞–±–æ—Ç—ã –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã. –ü–æ–¥—Ö–æ–¥ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Å–≤–æ–π—Å—Ç–≤ —Å–µ—Ä–≤–∏—Å–æ–≤: –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏, REST‚Äë–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è.

## üß± –û–±—â–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
| –£—Ä–æ–≤–µ–Ω—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|------------|
| Unit tests | –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –±–µ–∑ Spring-–∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ |
| Integration tests | –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã, –ë–î, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –±–∏–∑–Ω–µ—Å-—Ñ–ª–æ—É |
| Contract tests | –ì–∞—Ä–∞–Ω—Ç–∏—è –Ω–µ–∏–∑–º–µ–Ω–Ω–æ—Å—Ç–∏ API –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ |

–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–π —Å—Ç–µ–∫: JUnit 5, Mockito, Spring Boot Test, MockMvc, spring-security-test, Testcontainers, Liquibase, Spring Cloud Contract.

---

# üí∞ Cash Service –∫–∞–∫ Microservice Chassis
Cash Service –≤—ã—Å—Ç—É–ø–∞–µ—Ç –∫–∞–∫ —Ç–∏–ø–æ–≤–æ–π microservice chassis: REST API, Security (OAuth2 Resource Server), Idempotency, —Ä–∞–±–æ—Ç–∞ —Å –ë–î, –≤—ã–∑–æ–≤—ã –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤, error handling. –ü–æ—ç—Ç–æ–º—É —Å–µ—Ä–≤–∏—Å –ø–æ–∫—Ä—ã—Ç —Ç–µ—Å—Ç–∞–º–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≥–ª—É–±–æ–∫–æ.

---

## üß™ Unit —Ç–µ—Å—Ç—ã (Cash Service, Transfer Service)
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞:
- —Å–æ–∑–¥–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –≤—ã–∑–æ–≤—ã AccountsClient –∏ NotificationsClient
- –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–ú–æ–∫–∏: CashOperationRepository, AccountsClient, NotificationsClient, –∞ —Ç–∞–∫–∂–µ –∏—Ö –∫–ª–æ–Ω—ã –∏–∑ Transfer Service.

---

## üîê Security-aware –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
–¢–µ—Å—Ç—ã –Ω–µ –æ—Ç–∫–ª—é—á–∞—é—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –∞ —ç–º—É–ª–∏—Ä—É—é—Ç JWT, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å RBAC.

```java
var auth = jwt().jwt(j -> j
        .claim("preferred_username", "alice")
        .claim("clientRoles", "cash.write")
).authorities(new SimpleGrantedAuthority("ROLE_cash.write"));
```

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:
- –¥–æ—Å—Ç—É–ø —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–æ–ª—å—é
- –∑–∞–ø—Ä–µ—Ç –±–µ–∑ —Ä–æ–ª–∏ (403)
- –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ @AuthenticationPrincipal Jwt

---

## üóÑ –†–∞–±–æ—Ç–∞ —Å –ë–î –≤ —Ç–µ—Å—Ç–∞—Ö
–ö–∞–∂–¥—ã–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –ø–æ–¥–Ω–∏–º–∞–µ—Ç PostgreSQL —á–µ—Ä–µ–∑ Testcontainers, –Ω–∞–∫–∞—Ç—ã–≤–∞–µ—Ç —Å—Ö–µ–º—É —á–µ—Ä–µ–∑ Liquibase –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π JPA-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

---

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ Cash Service
| –¢–µ—Å—Ç | –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç |
|------|----------------|
| operate_success_shouldReturn204 | –£—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| flow_reserveKey_thenOperate | –ü–æ–ª–Ω—ã–π –±–∏–∑–Ω–µ—Å-—Ñ–ª–æ—É |
| operate_twice_shouldReturn400or409 | –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å |
| operate_withoutWriteRole_shouldReturn403 | RBAC –∑–∞–ø—Ä–µ—Ç |

---

# üìú –ö–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã
–ö–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Spring Cloud Contract.

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã —Ñ–∏–∫—Å–∏—Ä—É—é—Ç HTTP –º–µ—Ç–æ–¥, URL, —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–ø—Ä–æ—Å–∞ –∏ –æ—Ç–≤–µ—Ç–∞, HTTP —Å—Ç–∞—Ç—É—Å. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è Cash Service –Ω–µ —Å–ª–æ–º–∞—é—Ç –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã.

### –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã Cash Service
1. GET /cash/operation-key ‚Üí 200 OK, JSON —Å operationId
2. POST /cash/operate ‚Üí 204 No Content –ø—Ä–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ
3. –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ ‚Üí 400 Bad Request –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—à–∏–±–∫–∏

---

## üéØ –ò—Ç–æ–≥
–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Cash Service –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, —Ä–∞–±–æ—Ç—É —Å –ë–î, REST-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã, –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã. –ü—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–µ —Ç–æ–ª—å–∫–æ –º–µ—Ç–æ–¥—ã, –Ω–æ –∏ –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã.

---

# üìå –ò—Ç–æ–≥–∏

–ü—Ä–æ–µ–∫—Ç –ø–æ–∑–≤–æ–ª–∏–ª –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å:

- OAuth2 / JWT
- Keycloak –≤ Docker-—Å–µ—Ç–∏
- Outbox-–ø–∞—Ç—Ç–µ—Ä–Ω–æ–º
- Idempotency
- Resilience4j
- Liquibase
- –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π

---

# üöß –¶–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–∞–ª–∏ –æ—á–µ–≤–∏–¥–Ω—ã, –Ω–æ –Ω–µ –±—ã–ª–∏ –¥–æ–≤–µ–¥–µ–Ω—ã –¥–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

–†–∞–±–æ—Ç–∞ –Ω–∞–¥ –ø—Ä–æ–µ–∫—Ç–æ–º –ø–æ–∑–≤–æ–ª–∏–ª–∞ –≤—ã—è–≤–∏—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è, —Ç—Ä–µ–±—É—é—â–∏–µ –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è.

### 1. Transfer Service –∫–∞–∫ SAGA

–°–µ—Ä–≤–∏—Å –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –ø–æ —Å–≤–æ–µ–π –ø—Ä–∏—Ä–æ–¥–µ —è–≤–ª—è–µ—Ç—Å—è —Ö–æ—Ä–æ—à–∏–º –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–º –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ **SAGA**.  
–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é –ª–æ–≥–∏–∫—É, –æ–¥–Ω–∞–∫–æ –≤ —Å–ª–µ–¥—É—é—â–µ–π —Ä–∞–±–æ—Ç–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è:

- —Ä–∞–∑–¥–µ–ª–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞ –¥–≤–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **—Ö–æ—Ä–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫—É—é SAGA**
- –¥–æ–±–∏—Ç—å—Å—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

---

### 2. –°–±–æ—Ä–∫–∞ multi-module –ø—Ä–æ–µ–∫—Ç–∞ –≤ Docker

–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–≤–µ—Å—Ç–∏ –¥–æ –∏–¥–µ–∞–ª–∞ 2-stage Dockerfile –¥–ª—è –º–Ω–æ–≥–æ–º–æ–¥—É–ª—å–Ω–æ–≥–æ Maven-–ø—Ä–æ–µ–∫—Ç–∞.  
–û—Å–Ω–æ–≤–Ω—ã–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:

- —Ä–∞–±–æ—Ç–∞ parent POM
- –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–ª–æ—ë–≤ –æ–±—Ä–∞–∑–∞
- —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ Docker Compose —Å multi-module —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π

–≠—Ç–∞ –∑–∞–¥–∞—á–∞ —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ BuildKit –∏ Maven cache-—Å–ª–æ—ë–≤.

---

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π

–ú–µ—Ö–∞–Ω–∏–∑–º –ø—Ä–æ–±—Ä–æ—Å–∞ –±–∏–∑–Ω–µ—Å-–∏—Å–∫–ª—é—á–µ–Ω–∏–π –æ—Ç —É—Ä–æ–≤–Ω—è —Å–µ—Ä–≤–∏—Å–æ–≤ –¥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —á–∞—Å—Ç–∏—á–Ω–æ.  
–í —Ä—è–¥–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –º–æ–∂–Ω–æ –±—ã–ª–æ:

- –¥–∞—Ç—å –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –±–æ–ª—å—à–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å error response

–≠—Ç–æ—Ç –∞—Å–ø–µ–∫—Ç –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è —É–ª—É—á—à–∏—Ç—å –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö.

### 4. openAPI

–û—á–µ–Ω—å –ø–æ–∂–∞–ª–µ–ª, —á—Ç–æ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª, –ø–æ—Å—Ç–∞—Ä–∞—é—Å—å –∑–∞–Ω—è—Ç—å—Å—è —ç—Ç–∏–º –∑–∞–≤—Ç—Ä–∞. –ü—Ä—è–º–æ —Å–∏–ª—å–Ω–æ –Ω–µ —Ö–≤–∞—Ç–∞–ª–æ –ø–ª–∞–Ω–∞ —Ä–∞–±–æ—Ç—ã. –ü—Ä–∏—á–∏–Ω–∞ –±–∞–Ω–∞–ª—å–Ω–∞, –Ω–∞–±—Ä–∞–ª –º–Ω–æ–≥–æ –Ω–æ–≤–æ–≥–æ, –∏ –ø—Ä–æ—Å—Ç–æ –Ω–µ –∑–Ω–∞–ª, –∫–∞–∫ –æ–Ω–æ –ø–æ–ª—É—á–∏—Ç—Å—è. –í –∏—Ç–æ–≥–µ —ç–∫—Å–ø—Ä–æ–º—Ç —Å—Ç–∞–ª –≤–¥–≤–æ–µ —Å–ª–æ–∂–Ω–µ–µ –æ–±–¥—É–º–∞–Ω–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.  


# –ê–≤—Ç–æ—Ä

–ò–≤–∞–Ω –í–∞—Å–∏–ª—å–µ–≤
