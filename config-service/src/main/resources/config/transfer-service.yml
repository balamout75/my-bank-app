    # Конфигурация для Transfer Service
  # Файл: transfer-service.yml
  server:
    port: 0

  spring:
    datasource:
      url: ${DB_URL:jdbc:postgresql://localhost:5432/mybank?currentSchema=transfer}
      username: ${DB_USER:mybank}
      password: ${DB_PASSWORD:mybank_password}
    liquibase:
      change-log: classpath:db/changelog/db.changelog-master.xml
      default-schema: transfer
      liquibase-schema: public
    security:
      oauth2:
        client:
          registration:
            transfer-service:
              provider: transfer-service
              client-id: transfer-service
              client-secret: ${KC_CLIENT_SECRET_TRANSFER_SERVICE:RnGnXR7iX8ZSgb5lSiiG53QteuGrKC9h}
              authorization-grant-type: client_credentials
          provider:
            transfer-service:
              issuer-uri: ${KEYCLOAK_ISSUER_URI:http://localhost:8080/realms/mybank}
        resourceserver:
          jwt:
            issuer-uri: ${KEYCLOAK_ISSUER_URI:http://localhost:8080/realms/mybank}

  application:
    outbox:
      fixed-delay-ms: 5000
      order:
        limit: 10
      max-attempts: 5

  resilience4j:
    retry:
      retry-aspect-order: 2
      instances:
        accounts-service:
          max-attempts: 3
          wait-duration: 500ms
          exponential-backoff-multiplier: 2
          retry-exceptions:
            - org.springframework.web.client.ResourceAccessException
            - org.springframework.web.client.HttpServerErrorException
            - java.net.ConnectException
            - java.net.SocketTimeoutException
            - java.io.IOException
          ignore-exceptions:
            - io.github.resilience4j.circuitbreaker.CallNotPermittedException
            - org.springframework.web.client.HttpClientErrorException

        notifications-service:
          max-attempts: 2
          wait-duration: 300ms
          exponential-backoff-multiplier: 2
          retry-exceptions:
            - org.springframework.web.client.ResourceAccessException
            - org.springframework.web.client.HttpServerErrorException
            - java.net.ConnectException
            - java.net.SocketTimeoutException
            - java.io.IOException
          ignore-exceptions:
            - io.github.resilience4j.circuitbreaker.CallNotPermittedException
            - org.springframework.web.client.HttpClientErrorException

    circuitbreaker:
      circuitbreaker-aspect-order: 1
      instances:
        accounts-service:
          register-health-indicator: true
          sliding-window-type: COUNT_BASED
          sliding-window-size: 10
          minimum-number-of-calls: 5
          failure-rate-threshold: 50
          wait-duration-in-open-state: 30s
          permitted-number-of-calls-in-half-open-state: 3
          automatic-transition-from-open-to-half-open-enabled: true
          ignore-exceptions:
            - org.springframework.web.client.HttpClientErrorException
          record-exceptions:
            - org.springframework.web.client.ResourceAccessException
            - org.springframework.web.client.HttpServerErrorException
            - java.io.IOException
            - java.net.SocketTimeoutException

        notifications-service:
          register-health-indicator: true
          sliding-window-type: COUNT_BASED
          sliding-window-size: 5
          minimum-number-of-calls: 3
          failure-rate-threshold: 50
          wait-duration-in-open-state: 15s
          permitted-number-of-calls-in-half-open-state: 2
          automatic-transition-from-open-to-half-open-enabled: true
          ignore-exceptions:
            - org.springframework.web.client.HttpClientErrorException
          record-exceptions:
            - org.springframework.web.client.ResourceAccessException
            - org.springframework.web.client.HttpServerErrorException
            - java.io.IOException
            - java.net.SocketTimeoutException

    timelimiter:
      instances:
        accounts-service:
          timeout-duration: 5s
        notifications-service:
          timeout-duration: 3s

  management:
    endpoints:
      web:
        exposure:
          include: health, info, circuitbreakers, retries, metrics
    endpoint:
      health:
        show-details: always
    health:
      circuitbreakers:
        enabled: true

  eureka:
    client:
      service-url:
        defaultZone: http://localhost:8761/eureka/

  logging:
    level:
      com.mybank.transfer: DEBUG
      org.springframework.security: DEBUG